<div class="settings-wrapper">

  <!-- Initial page with choice - what settings page (tab) to open? -->
  <div class="choice-page" data-bind="visible: !showDetailPage()">
    <img class="settings-header" src="plugin/thespaghettidetective/static/img/settings-header.svg" alt="">
    <div class="settings-content">
      <div class="choice-wrapper">
        <div class="choice-option">
          <a href="#" class="button btn-block" data-bind="click: function(data, event) { selectPage('advanced'); }">Settings</a>
          <ul class="squared-markers">
            <li>Text</li>
            <li>Text</li>
            <li>Text</li>
          </ul>
        </div>
        <div class="choice-option">
          <a href="#" class="button btn-block" data-bind="click: function(data, event) { selectPage('troubleshooting'); }">Troubleshooting</a>
          <ul class="squared-markers">
            <li>Server connection status</li>
            <li>Webcam streaming issues</li>
            <li>Re-run setup wizard</li>
          </ul>
        </div>
      </div>
      <div class="footer">
        <img src="plugin/thespaghettidetective/static/img/chat.svg" alt="">
        <div class="notes">
          Join <a href="https://discord.com/invite/NcZkQfj" target="_blank">our Discord server</a><br>
          Visit <a href="https://thespaghettidetective.com/" target="_blank">thespaghettidetective.com</a><br>
          Download the app through the <a href="#" target="_blank">Google Playstore</a> or <a href="#" target="_blank">App Store</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Page with tabs at the top -->
  <div class="tabbable" data-bind="visible: showDetailPage()">
    <ul class="nav">
      <img src="plugin/thespaghettidetective/static/img/logo-white.svg" alt="" class="logo" data-bind="click: returnToSelection">
      <li data-page="advanced">
        <a href="#advanced" data-toggle="tab">
          <span>Settings</span>
        </a>
      </li>
      <li data-page="troubleshooting">
        <a href="#troubleshooting" data-toggle="tab">
          <span>Troubleshooting</span>
        </a>
      </li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane" id="troubleshooting">
        <section>
          <h1 class="section-title">Plugin Status</h1>
          <div class="section-content">
            <div class="test-connection-wrapper">
              <div class="section-panel">
                <div class="status-line success"><i class="fa fa-circle"></i>Server connection: Okay</div>
                <div class="status-line success"><i class="fa fa-circle"></i>Webcam connection: Okay</div>
                <div style="margin-top: 18px;"><a href="#diagnosticReportModal" onclick="$('#diagnosticReportModal').modal({backdrop: 'static', keyboard: false})">Plugin self-diagnostic report</a></div>
              </div>
              <div class="section-panel">
                <button class="circle">TEST</button>
              </div>
            </div>
          </div>
        </section>
        <section>
          <h1 class="section-title">Troubleshooting Tips</h1>
          <p>Make sure you have followed <a href="https://www.thespaghettidetective.com/docs/octoprint-plugin-setup/">the setup guide</a> to link OctoPrint to your The Spaghetti Detective account successfully. Check out our <a href="https://www.thespaghettidetective.com/help/">help docs</a> for detailed troubleshooting guides.</p>
          <div class="section-content">
            <div class="toggle">
              <h3 class="toggle-title">
                Webcam streaming
                <span class="counter">4</span>
              </h3>
              <div class="toggle-content">
                <h5>I'm getting laggy webcam streaming.</h5>
                <ul>
                  <li>If you have a free The Spaghetti Detective account and it's out of the free trial period, your webcam streaming will be 1 frame per 10 seconds. <a href="https://www.thespaghettidetective.com/docs/upgrade-to-pro/#what-cant-the-detective-just-work-for-free-people-love-free-you-know">25 frames per second webcam streaming is a premium feature for Pro accounts only.</a></li>
                  <li>Have you restarted OctoPrint and/or your Rasbperry Pi after upgrading to Pro account?</li>
                  <li>Make sure premium webcam streaming is not disabled in the "Settings" section.</li>
                </ul>
                <h5>Webcam streaming doesn't work.</h5>
                <ul>
                  <li>Basic webcam streaming (free account) is on only when you are printing. You won't see a webcam feed when the printer is idle.</li>
                  <li>However, premium webcam streaming is always on. If you have a Pro account, you should see webcam feed even if the printer is idle.</li>
                  <li>You need to make sure webcam URL is configured correctly in OctoPrint, and can be reached from your Raspberry Pi.</li>
                  <li>Check out <a href="https://www.thespaghettidetective.com/docs/webcam-feed-is-not-showing/">the detailed help document</a>.</li>
                </ul>
                <h5>I got a warning that says "switched to basic streaming".</h5>
                <ul>
                  <li>This warning means the premium streaming process failed to start. You will only get the basic streaming, if your account is eligible for the 25fps premium streaming. If you have a Pro account, you can <a href="mailto:support@thespaghettidetective.com">get help from the TSD team</a>.</li>
                </ul>
                <h5>I got a warning that says "streaming uses excessive CPU".</h5>
                <ul>
                  <li>If you have set streaming compability mode to "always", please set it back to "auto".</li>
                  <li>If you have to always stream in compability mode, set webcam resolution to 640x480, fps to 10. Then restart the Pi.</li>
                  <li>Learn more about <a href="https://www.thespaghettidetective.com/docs/streaming-compatibility-mode/">the streaming compability mode</a>.</li>
                </ul>
              </div>
            </div>
            <div class="toggle">
              <h3 class="toggle-title">
                Failure detection
                <span class="counter">2</span>
              </h3>
              <div class="toggle-content">
                <h5>I got a spaghetti alert but there was nothing wrong.</h5>
                <ul>
                  <li>This happens because The Detective is not perfect at her job yet.  <a href="https://www.thespaghettidetective.com/docs/help-the-detective-improve/">Help her improve.</a></li>
                </ul>
                <h5>The Detective is "not watching".</h5>
                <ul>
                  <li>The Detective is not detecting when your printer is not printing.</li>
                  <li>You have left "watching for failures" off.</li>
                  <li>The plugin has trouble connecting to The Spaghetti Detective server</li>
                  <li>You have run out of  <a href="https://www.thespaghettidetective.com/docs/how-does-detective-hour-work/">Detective Hours</a>.</li>
                </ul>
              </div>
            </div>
            <div class="toggle">
              <h3 class="toggle-title">
                Other problems
                <span class="counter">2</span>
              </h3>
              <div class="toggle-content">
                <h5>My OctoPrint is running, but the page shows "OctoPrint is offline".</h5>
                <ul>
                  <li>Your Rasbperry Pi may have issue connecting to the internet. Check the connection status on this page for errors.</li>
                  <li>The credentials established in the process of linking OctoPrint to your account may have been lost or corrupted. For instance, if you have re-installed OctoPrint, or have a corrupted SD card.</li>
                  <li>As the last resort, you re-run the setup wizard (below) to re-establish the credentials to link OctoPrint to your account.</li>
                </ul>
                <h5>Help! The web page doesn't seem to work correctly.</h5>
                <ul>
                  <li>It's almost always a good idea to just try "hard-refreshing" the page. Here is <a href="https://en.scratch-wiki.info/wiki/Help:Hard_Refresh">how you hard-refresh a page</a>.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
        <section>
          <h1 class="section-title">Re-run Setup Wizard</h1>
          <div class="section-content">
            <div>
            If you can no longer log into your The Spaghetti Detective account, e.g., you don't remember what email you signed up with, you can re-run the setup wizard to link your OctoPrint with a new The Spaghetti Detective account.
            </div>
            <div>
              <a href="#wizardModal" class="button" onclick="$('#wizardModal').modal({backdrop: 'static', keyboard: false})">Re-run Wizard</a>
            </div>
          </div>
        </section>
      </div>
      <div class="tab-pane" id="advanced">
        <section>
          <h1 class="section-title">Section 1</h1>
          <div class="section-content">
            <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Fugiat est ex qui perferendis quo quasi corrupti sit laboriosam totam suscipit nobis neque optio vitae, laudantium aspernatur velit accusamus. Maxime, harum!</p>
          </div>
        </section>
        <section>
          <h1 class="section-title">Section 2</h1>
          <div class="section-content">
            <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Fugiat est ex qui perferendis quo quasi corrupti sit laboriosam totam suscipit nobis neque optio vitae, laudantium aspernatur velit accusamus. Maxime, harum!</p>
          </div>
        </section>
        <section>
          <h1 class="section-title">Section 3</h1>
          <div class="section-content">
            <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Fugiat est ex qui perferendis quo quasi corrupti sit laboriosam totam suscipit nobis neque optio vitae, laudantium aspernatur velit accusamus. Maxime, harum!</p>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>

<!-- Wizard Modal -->
<div id="wizardModal" class="modal hide fade wizard-modal" tabindex="-1" role="dialog" aria-labelledby="wizardModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
    <h3 id="wizardModalLabel">The Spaghetti Detective Setup Wizard</h3>
  </div>
  <div class="modal-body" data-bind="allowBindings: false">
    {% include "thespaghettidetective_wizard.jinja2" %}
  </div>
</div>

<div id="diagnosticReportModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="diagnosticReportModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
    <h3 id="diagnosticReportModalLabel">The Spaghetti Detective Diagnostic Report</h3>
  </div>
  <div class="modal-body">
    <i>*Note: This report is to diagnostic information for potential problems in <b>Access Anywhere - The Spaghetti Detective</b> plugin. It is not a diagnosis for your print failures.</i>
    <br /><br />
    <b class="text-success" data-bind="visible: (errorStats.webcam.errorCount() + errorStats.server.errorCount()) <= 0">
      There have been no errors since last time OctoPrint rebooted.
    </b>
    <b class="text-error" data-bind="visible: (errorStats.webcam.errorCount() + errorStats.server.errorCount()) > 0">
      The Spaghetti Detective plugin has run into issues. These issues may have prevented The Detective from watching your print effectively. Please check out our <a href="https://www.thespaghettidetective.com/docs/connectivity-error-report/">trouble-shooting page</a> or <a href="https://www.thespaghettidetective.com/docs/contact-us-for-support/">reach out to us</a> for help.
    </b>
    <div data-bind="visible: errorStats.webcam.errorCount() > 0">
      <hr />
      <p class="text-error">
        The plugin has failed to connect to the webcam <b> webcamErrors.errorCount </b> times (error rate <b> Math.round(webcamErrors.errorCount / self.errorStats.webcam.attempts * 100) %</b>) since OctoPrint rebooted.
      </p>
      <ul>
        <li>The first error occurred at: <b> webcamErrors.first </b>.</li>
        <li>The most recent error occurred at: <b>webcamErrors.last </b>.</li>
      </ul>
      <p>
        Please go to "Settings" -> "Webcam & Timelapse" and make sure the stream URL and snapshot URL are set correctly.
      </p>
    </div>
  </div>
</div>
